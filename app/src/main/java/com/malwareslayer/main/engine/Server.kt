package com.malwareslayer.main.engine

import android.app.PendingIntent
import android.widget.TextView

import io.ktor.server.engine.*
import io.ktor.server.netty.*


class Server(private val port: Int, private val viewer: TextView, private val sent: PendingIntent, private val delivered: PendingIntent) {
    private var engine: ApplicationEngine
    private var random: String = (1..4).map { ('0'..'9').random() }.joinToString("")

    init {
        engine = embeddedServer(factory = Netty, port = port) {
            setup(random, viewer, sent, delivered)
        }

        viewer.append("Setup Server [$port]\n")
        viewer.append("PIN: $random\n")
    }

    public fun start(wait: Boolean): ApplicationEngine {
        viewer.append("Start Server...\n\n")

        return engine.start(wait = wait)
    }

    public fun stop(gracePeriodMillis: Long = 500, timeoutMillis: Long = 500) {
        viewer.append("Stop Server...\n")

        engine.stop(gracePeriodMillis, timeoutMillis)
    }
}